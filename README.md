# Linear Analysis Toolkit

Introduction:

This programming project consists of code written in Matlab to perform linear elastic analysis of three-dimensional frame element structures.  The user specifies all the input information using the MASTAN2 graphical user interface (GUI) and preprocessor. The program handles free, fixed, and displacement specified support conditions; prismatic beam-column elements including flexural and shear deformations; concentrated nodal forces specified in global coordinates; and uniform member loads defined in the member coordinate system. The program does not handle members with moment releases.

Code Procdure:

The first task performed by the RunAnalysis method is calling the classifyDOF method of the analysis class. This method classifies all the structure degrees of freedom (DOFs) as either fixed, free, or displaced. The outputs of this function are three vectors consisting of the degree of freedom numbers corresponding to free, displaced, and supported degrees of freedom. They are titled free_dof, disp_dof, and supp_dof respectively. 

Next, the CreateNodes method is called. It loops through all the input structure nodes provided by the variable self.coord and creates an object of the node class for each, outputting an array of these objects whose dimensions are # of nodes x 1. This array is stored as an analysis class property called nodeobj. 

	 The node class constructor is first called by the CreateNodes method. The constructor of ABHI_node.m takes 2 arguments: node_coord and node_number. Node_coord is a 3x1 vector containing the x, y, and z coordinates of the node. The constructor calls a method of the node class called AssignDOF. This method uses the node_number property in an algorithm to assign DOF numbers to all the nodes in the structure.  The DOF numbers are assigned sequentially and based off of the node numbering specified by the user in MASTAN2. 
   
	After node objects are instantiated, the CreateElements method is called by the RunAnalysis Method. Similar to the CreateNodes method, the CreateElements method loops through all the elements in the structure, as defined by the “ends” variable, and creates an array that is # of elements x 1 of element objects.  It saves this array as a class property called eleobj. 
  
	When an object of the element class is created, the constructor must be passed the following variables to associate with that element: element_nodes, E, v, A Ayy, Azz, Iyy, Izz, J, and webdir. The element_nodes variable is a user created variable that is a 2x1 vector of two node objects. All of these arguments are saved as properties of the class by the constructor. Several element class methods are called from the constructor. The first is ComputeLength. ComputeLength computes the length of the element and stores the result as the length property.
  
The next method called from the element constructor is ComputeTransformationMatrix. This method computes the 12x12 3-D transformation matrix to convert global coordinates into local coordinates. The resulting Transformation matrix is saved as a property of the element class called self.Transformation. This will be useful later in calculating the global element stiffness matrix and recovering local element forces. 

	After ComputeTransformationMatrix has returned, the ComputeElasticStiffnessMatrix method of the element class is then called by the constructor. The standard 12x12 local elastic stiffness matrix including shear deformations is then formed utilizing symmetry to reduce the number of terms calculated. Next, the local elastic stiffness matrix is multiplied on the left by the transpose of the transformation matrix and on the right by the transformation matrix to produce the global elastic stiffness matrix. This matrix is then saved as a class property called self.k_global.
  
The last method called from the element constructor is RetrieveDOF. The purpose of this method is to create a vector of the 12 degrees of freedom numbers associated with element and save it as a property of the class called elem_dof. This way, each element object knows its own degrees of freedom and can be queried for that information later. 

	At this point, control is sent back to analysis class and the RunAnalysis method.  The next function called is the CreateStifnessMatrix method of the analysis class. This function returns the global stiffness matrix, K, for the structure.  First a matrix that is nDOF x nDOF is initialized with zeros. A for loop queries the ith element’s global stiffness matrix and 12x1 degree of freedom vector.  The global structure stiffness matrix is then created element by element based off the appropriate stiffness terms. At the end of the loop K is converted to a sparse matrix for storage purposes. 
  
The next function called from the RunAnalysis method is the CreateLoadVectors method.  This method creates a global vector of the concentrated loads on the structure and a global vector of all the fixed end forces on the structure.  The method then computes the equivalent forces acting on the free degrees of freedom by subtracting the fixed end forces from the concentrated loads at the free DOFs. 

In the process, the FixedEndForces method of the element class is called.  The FixedEndForces method takes in the uniform load w on the element, computes the fixed end forces on all degrees of freedom, then stores the fixed end forces vector in both local and global coordinates as properties for use later in recovering local element forces. 

	The next method called from RunAnalysis is the CreateStiffnessSubmatrices method. The role of this method is to partition the previously created global stiffness matrix based on the classification of the degrees of freedom. This method uses class properties self.K, self.free_dof, self.supp_dof, and self.disp_dof to compute and store the matrices Kfn, Knn, Ksn, Kff, Knf, and Ksf. 
  
	ComputeDisplacementsReactions is the next method called from RunAnalysis. It computes the global displacements at every free degree of freedom, computes the reactions, and formats the computed displacements and reactions for return to Mastan2. First, the displacements at the free DOFs are computed using the following equation {∆f}=[Kff]\{{Pf}-[Kfn]{∆n}}.  Next, the reactions at the supported degrees of freedom are computed taking into account specified support displacements using the following equation {Ps}=[Ksf]{∆f}+[Ksn]{∆n}+{Fefs}. Then, the forces at the displaced DOFs are computed using the following equation {Pn}=[Knf]{∆f}+[Knn]{∆n}+{Fefn} and stored in a vector. The reactions and displacements are assembled into arrays called REACT and DEFL respectively and saved as properties of the class. 
  
	The RecoverElementForces method is the last function called from RunAnalysis. This method accesses the DEFL property that was previously saved and partitions out the relevant displacements for each element in global coordinates. It passes the deflections down to the element class as inputs to the method ComputeForces. ComputeForces first multiplies the global element deflections by the transformation matrix to get them in local coordinates. It then multiplies the local deflections by the local stiffness matrix and adds the result to the fixed end forces (in local coordinates) for that element to get the forces on that element (local). This 1x12 vector of forces is returned and stored in the corresponding row of the ELE_FOR matrix. 
  
	Control now passes back to the ud_3d1el function where the GetMastan2Returns method of the analysis class is called. This method returns as outputs the DEFL, REACT, ELE_FOR, and AFLAG variables. Up to this point, all have been calculated except AFLAG.  From the GetMastan2Returns method DEFL, REACT, and ELE_FOR are retrieved. Then, a method called CheckKffMatrix is called which checks the condition number of the Kff matrix. This method computes the condition number of Kff,  and computes the number of significant digits lost in the algorithm.  The function sets AFLAG accordingly if the Kff matrix is considered ill-conditioned.  If less than 3 significant digits are kept in the analysis, AFLAG is set to 0 and MASTAN2 will report an “unstable structure.” If at least 3 significant digits are kept, then AFLAG is set to 1 and the analysis results will be reported. The method prints the condition number and the number of significant digits lost in the analysis for user transparency. 
  
	Next, the GetMastan2Returns method runs the ComputeError method which back calculates the load vector using the computed displacements, and computes the error with respect to the applied load vector. This result is printed to the command window. 
